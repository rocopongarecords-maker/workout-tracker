# Workout Tracker — V2 Implementation Plan

**Date:** 2025-02-12
**Status:** Phases 1-4 complete. This plan covers all remaining work through public launch and beyond.

---

## Phase 5 — Bug Fixes & Core UX Polish

> **Goal:** Fix known issues and improve daily workout experience.

### 5.1 Fix "Save Set" scroll-skipping bug
- **Problem:** After saving a set, the app sometimes skips several exercise cards instead of scrolling to the next set/exercise. Gets worse as the user progresses through the workout.
- **Root cause:** `scrollToNext` in `WorkoutScreen.jsx` uses `currentExerciseIndex` state which is stale inside the callback. The index advances correctly but the scroll target references the wrong element.
- **Fix:** Refactor `scrollToNext` to accept the target index directly instead of relying on stale state. Calculate the next scroll target from the `setNumber` and `setsCount` parameters passed in.
- **Files:** `src/components/WorkoutScreen.jsx`, `src/components/ExerciseCard.jsx`

### 5.2 Edit/resume a previous workout
- **Problem:** Once a workout is saved or marked complete, users can't go back to edit it.
- **Solution:**
  - In `WorkoutDaySelector`: tapping a completed day currently opens review. Add a "Resume / Edit" button on the `WorkoutReview` screen.
  - When editing, load `WorkoutScreen` pre-filled with the saved `userSets` data from `workoutHistory`.
  - On re-save, overwrite the existing `workoutHistory[day]` entry.
- **Files:** `src/components/WorkoutReview.jsx`, `src/components/WorkoutScreen.jsx`, `src/App.jsx`

### 5.3 Today's workout summary screen
- After the user marks a workout complete, show a summary screen before returning to Dashboard:
  - Workout name, date, duration (if we track start time)
  - Total volume, sets completed
  - Any PRs hit (ties into 5.5)
  - Volume comparison vs last time
- **Files:** New `src/components/WorkoutSummary.jsx`, update `src/App.jsx` flow

### 5.4 PR celebration (Robinhood-style)
- Detect when a user sets a personal record on any exercise (highest weight for given reps, or highest estimated 1RM).
- Compare against all previous `workoutHistory` entries for that exercise.
- Trigger a celebration animation: confetti burst + "NEW PR!" banner overlay.
- Use lightweight CSS animations (no heavy library). Confetti via canvas or CSS keyframes.
- Show in real-time when the user taps "Save Set" and the set is a PR.
- **Files:** New `src/components/PRCelebration.jsx`, update `src/components/ExerciseCard.jsx`, new `src/utils/detectPR.js`

### 5.5 Exercise info modal (AI-generated via Jeff agent)
- Add an info icon (ℹ) button next to each exercise name in `ExerciseCard`.
- On tap, open a modal/bottom sheet showing:
  - Muscle groups targeted
  - Form tips for proper execution
  - Common mistakes to avoid
- Content generated by the `/jeff` agent (see Phase 6) and cached locally.
- For MVP: hardcode info for all exercises in the Jeff Nippard program. AI generation can come later.
- **Files:** New `src/components/ExerciseInfoModal.jsx`, update `src/components/ExerciseCard.jsx`, new `src/data/exerciseInfo.js`

---

## Phase 6 — Jeff Agent & Badge System

> **Goal:** Add personality and gamification to the app.

### 6.1 Create the Jeff agent
- Create agent configuration file at project root for Claude Code.
- The agent should:
  - Be a personal trainer based on Jeff Nippard's Legs/Push/Pull program
  - Answer questions about exercises, form, periodization, workout structure
  - Use the PDF content as reference knowledge
  - Be invocable via `/jeff` command in Claude Code
- **Files:** `.claude/agents/jeff.md` (agent definition)

### 6.2 Badge system — data model
- Define badge categories:
  - **Milestone badges:** First workout, 10 workouts, 25, 50, all Block 1, all Block 2, program complete
  - **Consistency badges:** 3-day streak, 7-day streak, 4-week streak, never missed a week
  - **Strength badges:** First PR, 10 PRs, bodyweight squat, 1.5x bodyweight deadlift (if weight is tracked)
  - **Volume badges:** 10,000 kg total volume, 50,000 kg, 100,000 kg
  - **Explorer badges:** Tried all 6 workout types, completed first superset
- Store badge definitions in `src/data/badges.js`
- Earned badges stored in localStorage (later Supabase): `{ earnedBadges: [{ id, earnedAt }] }`

### 6.3 Badge detection engine
- `src/utils/checkBadges.js` — after each workout completion, check all badge conditions.
- Return newly earned badges (not previously earned).
- Trigger badge award animation (similar to PR celebration — toast + badge icon).
- **Files:** New `src/utils/checkBadges.js`, update `src/hooks/useWorkoutStorage.js` to store badges

### 6.4 Badge collection screen
- New view: `src/components/BadgeScreen.jsx`
- Grid of all badges — earned ones shown in color with date, unearned ones shown greyed out with progress hint.
- Accessible from Dashboard (trophy icon or "Badges" button).
- **Files:** New `src/components/BadgeScreen.jsx`, update `src/components/Dashboard.jsx`, update `src/App.jsx`

---

## Phase 7 — Analytics Dashboard & Body Measurements

> **Goal:** Give users data-driven insights into their progress.

### 7.1 Analytics dashboard
- New view: `src/components/AnalyticsScreen.jsx`
- **1RM Trends:** Line chart showing estimated 1RM over time for compound lifts (Squat, Bench, Deadlift, OHP). Use simple SVG path rendering (no chart library needed for MVP).
- **Weekly Volume:** Bar chart of total volume per week, color-coded by workout type.
- **Consistency Streak:** Current streak (days/weeks without missing), longest streak, calendar heatmap.
- Data derived from existing `workoutHistory` — no new storage needed.
- **Files:** New `src/components/AnalyticsScreen.jsx`, new `src/components/charts/SimpleLineChart.jsx`, new `src/components/charts/SimpleBarChart.jsx`

### 7.2 Body measurements tab
- New view: `src/components/MeasurementsScreen.jsx`
- **Weight tracking:**
  - Input weight (kg) with date
  - Show weight history as a line chart
  - Store in localStorage: `{ weightLog: [{ date, weight }] }`
- **Skinfold / BF% calculator:**
  - User selects protocol: Jackson-Pollock 3-site or 7-site
  - 3-site (men): chest, abdomen, thigh. 3-site (women): triceps, suprailiac, thigh
  - 7-site: chest, midaxillary, triceps, subscapular, abdomen, suprailiac, thigh
  - Calculate body density → BF% using Siri equation
  - Store history: `{ skinfoldLog: [{ date, protocol, sites: {}, bf }] }`
- **Files:** New `src/components/MeasurementsScreen.jsx`, new `src/utils/calculateBF.js`, update `src/hooks/useWorkoutStorage.js`

### 7.3 Navigation update
- Dashboard bottom area gets navigation icons: Home, Calendar, Analytics, Measurements, Badges
- Or a simple tab bar / button row at the bottom
- **Files:** Update `src/components/Dashboard.jsx`, `src/App.jsx`

---

## Phase 8 — Supabase Backend & Authentication

> **Goal:** Real database, user accounts, cross-device sync.

### 8.1 Supabase project setup
- Create Supabase project, add `@supabase/supabase-js`
- `src/lib/supabase.js` — client init with `VITE_SUPABASE_URL` + `VITE_SUPABASE_ANON_KEY`
- `.env.local` for dev keys, `.env.example` for reference

### 8.2 Database schema
```sql
profiles (id, display_name, created_at, start_date)
completed_workouts (id, user_id, day_number, workout_type, block, completed_at)
exercise_sets (id, workout_id, exercise_name, set_number, weight, reps, rest_time, completed)
weight_log (id, user_id, date, weight_kg)
skinfold_log (id, user_id, date, protocol, sites_json, bf_percent)
earned_badges (id, user_id, badge_id, earned_at)
```
- Row-Level Security on all tables (users only access own data)

### 8.3 Auth UI + hook
- `src/hooks/useAuth.js` — signIn, signUp, signInWithGoogle, signOut, resetPassword
- `src/components/AuthScreen.jsx` — login/signup form + Google OAuth button
- Auth guard wrapper: unauthenticated → AuthScreen, authenticated → app

### 8.4 Data migration
- Refactor `useWorkoutStorage` to read/write Supabase instead of localStorage
- One-time migration prompt: if localStorage has data and user just signed in, offer to import
- Offline fallback: localStorage as write-ahead cache, sync when back online

### 8.5 User profile + settings
- Update `SettingsScreen` with user info (email, display name)
- Sign out button
- Data export still works (fetches from Supabase, downloads JSON)

---

## Phase 9 — Production Hosting & Launch

> **Goal:** Go live with custom domain, ready for real users.

### 9.1 Vercel deployment
- Connect GitHub repo to Vercel
- Set environment variables (Supabase keys)
- Remove `base: '/workout-tracker/'` from `vite.config.js`
- Remove `gh-pages` dependency

### 9.2 Custom domain + PWA update
- Register domain, configure DNS in Vercel
- Update PWA manifest paths, icons, start_url
- Update Supabase redirect URLs

### 9.3 Launch polish
- Loading states / skeletons while Supabase loads
- Error boundary component
- Offline indicator
- Responsive audit (iPhone SE → iPad → desktop)
- Lighthouse PWA score > 90

### 9.4 Launch checklist
- [ ] Auth works (email + Google)
- [ ] Data syncs across devices
- [ ] PWA installs on iOS + Android
- [ ] Offline mode works
- [ ] Custom domain with HTTPS
- [ ] No console errors in production

---

## Phase 10 — Custom Programs & Exercise Library (Post-Launch)

> **Goal:** Users can create their own workout programs.

### 10.1 Exercise library
- Database table: `exercises (id, name, muscle_groups[], category, description, image_url)`
- Pre-seed with all exercises from both Jeff Nippard blocks + common gym exercises
- Search/filter by muscle group, name

### 10.2 Program builder
- **Full mode:** Name, schedule (which days), exercises per day, sets, reps, rest time, type (primary/secondary/isolation)
- **Simplified mode:** Just pick exercises, set reps and sets. Rest times and categories auto-assigned by defaults.
- Store as: `programs (id, user_id, name, schedule_json, created_at)`

### 10.3 Program selection (Duolingo-style)
- Program picker screen with cards (program name, duration, preview)
- User can be enrolled in multiple programs simultaneously
- Each program tracks its own progress independently
- Switcher in the Dashboard header (like Duolingo's language flag selector)
- New user onboarding: guided flow to pick first program

### 10.4 New user onboarding
- First-time users see a welcome flow:
  1. "What's your goal?" (strength, hypertrophy, general fitness)
  2. "How many days per week?"
  3. Recommended programs filtered by answers
  4. Select → start tracking

---

## Implementation Order

| Phase | What | Effort | Ship? |
|-------|------|--------|-------|
| **5** | Bug fixes, edit workout, summary, PR celebration, exercise info | Medium | Push to GH Pages |
| **6** | Jeff agent, badge system | Medium | Push to GH Pages |
| **7** | Analytics dashboard, body measurements | Medium | Push to GH Pages |
| **8** | Supabase + auth | High | Needed before Vercel |
| **9** | Vercel hosting, domain, launch | Medium | **GO LIVE** |
| **10** | Custom programs, exercise library, onboarding | High | Post-launch update |

---

## Notes

- Phases 5-7 are all localStorage-based and can ship to GitHub Pages immediately
- Phase 8 (Supabase) is the inflection point — after that, all data lives in the cloud
- Phase 10 (custom programs) depends on Supabase being live — don't build before
- Exercise info via AI: for MVP, hardcode tips. Jeff agent generates them during development, we bake the results into `exerciseInfo.js`
- Charts: SVG-based, no external chart library. Keep the bundle small.
